import pandas as pd
from pathlib import Path

DATA_DIR = Path("data")
RAW_CSV = DATA_DIR / "Android_Malware.csv"
OUT_CSV = DATA_DIR / "Android_Malware_clean.csv"

# Columns that MUST be removed (per HW)
DROP_COLS = [
    "Flow ID",
    "Source IP",
    "Source Port",
    "Destination IP",
    "Destination Port",
    "Protocol",
    "Timestamp",
]

LABEL_COL = "Label"

def main():
    # Read dataset
    df = pd.read_csv(RAW_CSV, low_memory=False)
    print(f"Original shape: {df.shape}")

    # Drop unwanted columns
    df = df.drop(columns=DROP_COLS, errors="ignore")

    # Drop common junk column if present
    df = df.drop(columns=["Unnamed: 0"], errors="ignore")

    # Check label column
    if LABEL_COL not in df.columns:
        raise ValueError(f"Label column '{LABEL_COL}' not found")

    # Split features and labels (for later use)
    X = df.drop(columns=[LABEL_COL])
    y = df[LABEL_COL]

    print(f"After cleaning shape: {df.shape}")
    print(f"X shape: {X.shape}, y shape: {y.shape}")
    print("\nLabel distribution:")
    print(y.value_counts())

    # Save cleaned dataset
    DATA_DIR.mkdir(exist_ok=True)
    df.to_csv(OUT_CSV, index=False)
    print(f"\nSaved cleaned dataset to {OUT_CSV}")

if __name__ == "__main__":
    main()
